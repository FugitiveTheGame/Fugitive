name: Publish Release → itch.io

on:
  release:
    types: [published]

jobs:
  upload_to_itch:
    # skip prereleases – remove the line below if you want them as well
    if: ${{ github.event.release.prerelease == false }}
    runs-on: ubuntu-latest

    steps:
      - name: Download release assets
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          mkdir -p dist
          gh release download ${{ github.event.release.tag_name }} \
            -R ${{ github.repository }} \
            -D dist

      - name: List downloaded assets
        run: |
          echo "Contents of dist directory:"
          ls -R dist

      - name: Set up Butler
        uses: jdno/setup-butler@v1

      - name: Push every build to itch.io
        env:
          BUTLER_API_KEY: ${{ secrets.ITCH_API_KEY }}
        run: |
          butler push dist/fugitive-windows.zip  stumpy-dog-studios/fugitive:windows-prod --userversion ${{ github.event.release.tag_name }}
          butler push dist/fugitive-linux.zip    stumpy-dog-studios/fugitive:linux-prod   --userversion ${{ github.event.release.tag_name }}
          butler push dist/fugitive-osx.zip      stumpy-dog-studios/fugitive:osx-prod     --userversion ${{ github.event.release.tag_name }}
          butler push dist/fugitive-android.apk  stumpy-dog-studios/fugitive:android-prod --userversion ${{ github.event.release.tag_name }}